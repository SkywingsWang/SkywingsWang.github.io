init();let status=!1,treasure=[],occupy=[],hero=null,killer=[],obstacle=[],round=1,surplus=0,killerScore=0,heroScore=0;function init(){const e=document.getElementById("table");for(let r=0;r<10;r++){let t=document.createElement("tr");for(let e=0;e<10;e++){let l=document.createElement("td");l.dataset.XY=`${r},${e}`,t.appendChild(l),l.onclick=function(){if(status)return;for(let t=0;t<occupy.length;t++)if(occupy[t][0]===r&&occupy[t][1]===e)return void alert("This grid is already occupied!");let t=prompt("Please type h/k/o/1-9");t&&analyseKey(t,r,e,t)}}e.appendChild(t)}}function analyseKey(e,r,t,l=null){switch(e){case"o":let o=document.createElement("div");o.style.width="100%",o.style.height="100%",o.style.backgroundColor="black",o.dataset.type="obstacle",o.classList.add("dom"),findTd(r,t).appendChild(o),obstacle.push([r,t]),occupy.push([r,t]);break;case"h":hero?alert("Only one hero can be set!"):(draw(findTd(r,t),"hero"),hero=[r,t],occupy.push([r,t]));break;case"k":draw(findTd(r,t),"killer"),killer.push([r,t]),occupy.push([r,t]);break;default:/^[1-9]$/.exec(e)?(draw(findTd(r,t),"treasure",l),surplus++,updateScore(),treasure.push([r,t,l]),occupy.push([r,t])):alert("Error: Wrong input!")}}function draw(e,r,t=null){let l=document.createElement("img");l.src=`./image/${r}.png`,l.style.width="100%",l.style.height="100%",l.style.display="block",l.dataset.type=r,t&&(l.dataset.score=t),l.classList.add("dom"),l.onload=function(){e.append(l)}}function findTd(e,r){return document.getElementsByTagName("tr")[e].getElementsByTagName("td")[r]}function nextStage(){hero?0===treasure.length?(round++,reset("It is a draw!")):status=!0:alert("We need a hero to start!")}function end(){status?reset(killerScore===heroScore?"It is a draw":killerScore>heroScore?"Your score is lower than the killer--You lose!":"You win!"):alert("The game haven not begin!")}function move(e,r,t,l,o,n=!0,a=null){if(r<0||r>9||t<0||t>9)return void alert("Can not walk into nothingness!");const s=findTd(r,t).getElementsByClassName("dom")[0];if(s){if("obstacle"===s.dataset.type)return;if("killer"===s.dataset.type&&"hero"===o)return round++,void reset("You died! Game over!");if("treasure"===s.dataset.type){"hero"===o?heroScore+=parseInt(s.dataset.score):killerScore+=parseInt(s.dataset.score);for(let e=0;e<treasure.length;e++)treasure[e][0]===r&&treasure[e][1]&&treasure.splice(e,1);if(surplus--,updateScore(),s.remove(),0===surplus)return round++,void reset(heroScore>killerScore?"You win!":"Your score is lower than the killer--You lose!")}else if("hero"===s.dataset.type)return s.remove(),findTd(r,t).append(e.getElementsByTagName("img")[0]),round++,void reset("The hero is died, you lose!")}if("hero"===o?(hero[0]=r,hero[1]=t):(killer[a][0]=r,killer[a][1]=t),findTd(r,t).append(e.getElementsByTagName("img")[0]),n)for(let e=0;e<killer.length;e++){const r=killer[e][0],t=killer[e][1];let l=Math.abs(hero[0]-r)+Math.abs(hero[1]-t),o={index:null,distance:99,X:null,Y:null,XY:[]};for(let e=0;e<treasure.length;e++){let l=Math.abs(treasure[e][0]-r)+Math.abs(treasure[e][1]-t);l<o.distance&&(o={index:e,distance:l,X:treasure[e][0],Y:treasure[e][1],XY:[treasure[e][0],treasure[e][1]]})}let n=o.XY;l<o.distance&&(n=hero);let a=killer[e][0],s=killer[e][1];Math.abs(n[0]-killer[e][0])<=1&&Math.abs(n[1]-killer[e][1])<=1?(a=n[0],s=n[1]):n[0]===killer[e][0]&&n[1]>killer[e][1]?s++:n[0]===killer[e][0]&&n[1]>killer[e][1]?s--:n[1]===killer[e][1]&&n[0]>killer[e][0]?a++:n[1]===killer[e][1]&&n[0]<killer[e][0]?a--:n[0]<killer[e][0]&&n[1]<killer[e][1]?(a--,s--):n[0]>killer[e][0]&&n[1]<killer[e][1]?(a++,s--):n[0]<killer[e][0]&&n[1]>killer[e][1]?(a--,s++):n[0]>killer[e][0]&&n[1]>killer[e][1]&&(a++,s++),move(findTd(r,t),a,s,"killer","killer",!1,e)}}function reset(e){status=!1,treasure=[],occupy=[],hero=null,killer=[],obstacle=[],surplus=0,killerScore=0,heroScore=0,updateScore();let r=document.getElementsByTagName("td");for(let e=0;e<r.length;e++)r[e].innerHTML="";alert(e)}function updateScore(){document.getElementById("round").innerText=`${round}`,document.getElementById("surplus").innerText=`${surplus}`,document.getElementById("killerScore").innerText=`${killerScore}`,document.getElementById("heroScore").innerText=`${heroScore}`}document.onkeydown=function(e){if(!status)return;const r=e||window.e;switch(r.keyCode||r.which){case 87:move(findTd(hero[0],hero[1]),hero[0]-1,hero[1],"hero","hero");break;case 83:move(findTd(hero[0],hero[1]),hero[0]+1,hero[1],"hero","hero");break;case 65:move(findTd(hero[0],hero[1]),hero[0],hero[1]-1,"hero","hero");break;case 68:move(findTd(hero[0],hero[1]),hero[0],hero[1]+1,"hero","hero")}};